<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firm VAT Dynamic Modeling</title>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']]
            }
        };
    </script>
    <style>
        body {
            font-family: 'Computer Modern', 'Times New Roman', serif;
            line-height: 1.8;
            font-size: 18px;
            max-width: 900px;
            margin: 0 auto;
            padding: 40px 20px;
            background: white;
        }
        h1 {
            text-align: center;
            font-size: 2.2em;
            margin-bottom: 40px;
        }
        h2 {
            margin-top: 35px;
            font-size: 1.6em;
        }
        .equation {
            margin: 25px 0;
            overflow-x: auto;
            font-size: 1.1em;
        }
    </style>
</head>
<body>
    <h1>Firm VAT Dynamic Modeling</h1>
    
    <h2>1. Introduction</h2>
    
    <div class="equation">
        $$\max_{y_i} (1-\tau(y_i))y_i-c_i(y_i)$$
    </div>
    
    <div class="equation">
        $$[y_i]: (1-\tau(y_i))- y_i \cdot \frac{\partial\tau(y_i)}{\partial y_i}-\frac{\partial c_i(y_i)}{\partial y_i}=0$$
    </div>
    
    <div class="equation">
        $$\tau_{gov}(y_i)=f \text{ is known.}$$
    </div>
    
    <h2>2. Deriving Marginal Cost from Data</h2>
    
    <p>From the production function with Cobb-Douglas technology:</p>
    
    <div class="equation">
        $$Y_i = A_i X_i^{\alpha}$$
    </div>
    
    <p>Inverting to get cost function:</p>
    
    <div class="equation">
        $$X_i = \left(\frac{Y_i}{A_i}\right)^{1/\alpha}$$
    </div>
    
    <p>Therefore, the cost function is:</p>
    
    <div class="equation">
        $$c_i(y_i) = \left(\frac{y_i}{A_i}\right)^{1/\alpha}$$
    </div>
    
    <p>Taking the derivative with respect to output:</p>
    
    <div class="equation">
        $$\frac{\partial c_i(y_i)}{\partial y_i} = \frac{1}{\alpha} \cdot \frac{1}{A_i^{1/\alpha}} \cdot y_i^{\frac{1-\alpha}{\alpha}}$$
    </div>
    
    <p>Substituting back the cost function:</p>
    
    <div class="equation">
        $$\frac{\partial c_i(y_i)}{\partial y_i} = \frac{1}{\alpha} \cdot \frac{c_i(y_i)}{y_i}$$
    </div>
    
    <h2>3. From Your Data</h2>
    
    <p>Since you observe $X_i$ (input costs) and $Y_i$ (turnover) for each firm:</p>
    
    <div class="equation">
        $$\frac{\partial c_i(y_i)}{\partial y_i} = \frac{1}{\alpha} \cdot \frac{X_i}{Y_i}$$
    </div>
    
    <p>Where:</p>
    <ul>
        <li>$\alpha = 0.9864$ (your calibrated parameter)</li>
        <li>$X_i$ = annual_input_k × 1000 (from data)</li>
        <li>$Y_i$ = annual_turnover_k × 1000 (from data)</li>
    </ul>
    
    <p>Therefore, for each firm:</p>
    
    <div class="equation">
        $$\frac{\partial c_i(y_i)}{\partial y_i} = \frac{1}{0.9864} \cdot \frac{\text{input}_i}{\text{turnover}_i} = 1.014 \cdot \frac{\text{input}_i}{\text{turnover}_i}$$
    </div>
    
    <h2>4. Smooth Tax Function: Sigmoid Approximation</h2>
    
    <p>Instead of a step function at threshold $T^*$, we use a smooth sigmoid transition:</p>
    
    <div class="equation">
        $$\tau(y_i) = \tau_{max} \cdot \frac{1}{1 + e^{-k(y_i - T^*)}}$$
    </div>
    
    <p>Where:</p>
    <ul>
        <li>$\tau_{max}$ = maximum effective VAT rate (from data)</li>
        <li>$T^* = £85,000$ (VAT threshold)</li>
        <li>$k$ = steepness parameter (larger $k$ → sharper transition)</li>
    </ul>
    
    <p>The derivative of the sigmoid tax function:</p>
    
    <div class="equation">
        $$\frac{\partial \tau(y_i)}{\partial y_i} = \tau_{max} \cdot \frac{k \cdot e^{-k(y_i - T^*)}}{(1 + e^{-k(y_i - T^*)})^2}$$
    </div>
    
    <p>Simplifying using $\tau(y_i)$:</p>
    
    <div class="equation">
        $$\frac{\partial \tau(y_i)}{\partial y_i} = k \cdot \tau(y_i) \cdot (1 - \frac{\tau(y_i)}{\tau_{max}})$$
    </div>
    
    <h2>5. Deriving the First-Order Condition</h2>
    
    <p><strong>Starting from the profit maximization problem:</strong></p>
    
    <div class="equation">
        $$\max_{y_i} \pi_i = (1-\tau(y_i))y_i - c_i(y_i)$$
    </div>
    
    <p><strong>Taking the derivative with respect to $y_i$:</strong></p>
    
    <div class="equation">
        $$\frac{\partial \pi_i}{\partial y_i} = \frac{\partial}{\partial y_i}[(1-\tau(y_i))y_i] - \frac{\partial c_i(y_i)}{\partial y_i}$$
    </div>
    
    <p><strong>Applying the product rule to the first term:</strong></p>
    
    <div class="equation">
        $$\frac{\partial}{\partial y_i}[(1-\tau(y_i))y_i] = (1-\tau(y_i)) \cdot 1 + y_i \cdot \frac{\partial}{\partial y_i}[1-\tau(y_i)]$$
    </div>
    
    <div class="equation">
        $$= (1-\tau(y_i)) + y_i \cdot \left(-\frac{\partial\tau(y_i)}{\partial y_i}\right)$$
    </div>
    
    <div class="equation">
        $$= (1-\tau(y_i)) - y_i \cdot \frac{\partial\tau(y_i)}{\partial y_i}$$
    </div>
    
    <p><strong>Setting FOC equal to zero:</strong></p>
    
    <div class="equation">
        $$\frac{\partial \pi_i}{\partial y_i} = (1-\tau(y_i)) - y_i \cdot \frac{\partial\tau(y_i)}{\partial y_i} - \frac{\partial c_i(y_i)}{\partial y_i} = 0$$
    </div>
    
    <p><strong>Rearranging to isolate $(1-\tau(y_i^*))$:</strong></p>
    
    <div class="equation">
        $$(1-\tau(y_i^*)) = \frac{\partial c_i(y_i^*)}{\partial y_i} + y_i^* \cdot \frac{\partial\tau(y_i^*)}{\partial y_i}$$
    </div>
    
    <p>The correct FOC shows that marginal revenue $(1-\tau)$ equals marginal cost plus the <strong>tax wedge effect</strong> $y_i \cdot \frac{\partial\tau}{\partial y_i}$, which represents the additional tax burden from producing one more unit.</p>
    
    <p><strong>Step 1: Substitute Known Functions</strong></p>
    
    <p>With sigmoid tax and Cobb-Douglas cost:</p>
    
    <div class="equation">
        $$1 - \frac{\tau_{max}}{1 + e^{-k(y_i^* - T^*)}} = \frac{1}{\alpha} \cdot \frac{1}{A_i^{1/\alpha}} \cdot (y_i^*)^{\frac{1-\alpha}{\alpha}} + \frac{k \cdot \tau_{max} \cdot e^{-k(y_i^* - T^*)}}{(1 + e^{-k(y_i^* - T^*)})^2}$$
    </div>
    
    <h2>6. Extracting Elasticity from Calibrated Model</h2>
    
    <p><strong>Method A: Numerical Derivative</strong></p>
    
    <p>For small change in tax rate $\Delta\tau$:</p>
    
    <div class="equation">
        $$\varepsilon = \frac{\ln y^*(\tau_{max} + \Delta\tau) - \ln y^*(\tau_{max})}{\ln(1-\tau_{max}-\Delta\tau) - \ln(1-\tau_{max})}$$
    </div>
    
    <p><strong>Method B: From Bunching Width</strong></p>
    
    <p>The bunching width in the calibrated model implies:</p>
    
    <div class="equation">
        $$\Delta Y^* = Y_{max}^{bunch} - T^*$$
    </div>
    
    <p>Where $Y_{max}^{bunch}$ is the highest counterfactual output among bunching firms.</p>
    
    <p>The implied elasticity is:</p>
    
    <div class="equation">
        $$\varepsilon = \frac{\Delta Y^*/T^*}{\tau_{effective}}$$
    </div>
    
    <p>Where $\tau_{effective} = \frac{\tau_{max}}{2}$ at the threshold.</p>
    
    <p><strong>Method C: Aggregate Response</strong></p>
    
    <p>Compare total output with and without VAT:</p>
    
    <div class="equation">
        $$\varepsilon_{aggregate} = \frac{\ln(\sum_i y_i^{no-vat}) - \ln(\sum_i y_i^{with-vat})}{\ln(1) - \ln(1-\bar{\tau})}$$
    </div>
    
    <p>Where $\bar{\tau}$ is the average effective tax rate.</p>
    
    <h2>7. Adding Uncertainty: Freedom Parameter for Distribution Matching</h2>
    
    <p><strong>Problem:</strong> Add uncertainty about future turnover to better match observed distribution.</p>
    
    <p><strong>Modified FOC with Uncertainty:</strong></p>
    
    <p>Firms are uncertain about their actual output and solve:</p>
    
    <div class="equation">
        $$\max_{y_i} \mathbb{E}[\pi_i] = \mathbb{E}[(1-\tau(y_i + \epsilon_i))(y_i + \epsilon_i) - c_i(y_i + \epsilon_i)]$$
    </div>
    
    <p>Where $\epsilon_i \sim N(0, \sigma^2 \cdot y_i)$ represents proportional uncertainty.</p>
    
    <p><strong>Approximation using Certainty Equivalent:</strong></p>
    
    <p>The FOC becomes:</p>
    
    <div class="equation">
        $$1 - \frac{\tau_{max}}{1 + e^{-k(y_i^* - T^*)}} = \frac{1}{\alpha} \cdot \frac{1}{A_i^{1/\alpha}} \cdot (y_i^*)^{\frac{1-\alpha}{\alpha}} + y_i^* \cdot \frac{k \cdot \tau_{max} \cdot e^{-k(y_i^* - T^*)}}{(1 + e^{-k(y_i^* - T^*)})^2} \cdot (1 + \gamma \cdot \sigma^2)$$
    </div>
    
    <p>Where $\gamma$ is a risk-aversion parameter and $\sigma^2$ is the uncertainty parameter (freedom parameter).</p>
    
    <p><strong>Alternative: Smoothed Response with Uncertainty</strong></p>
    
    <p>Firms choose output based on expected position relative to threshold:</p>
    
    <div class="equation">
        $$P(\text{above threshold}) = \Phi\left(\frac{y_i - T^*}{\sigma \cdot y_i}\right)$$
    </div>
    
    <p>Where $\Phi$ is the normal CDF and $\sigma$ is the uncertainty parameter.</p>
    
    <p>The perceived tax rate becomes:</p>
    
    <div class="equation">
        $$\tau_{perceived}(y_i) = \tau_{max} \cdot \Phi\left(\frac{y_i - T^*}{\sigma \cdot y_i}\right)$$
    </div>
    
    <p><strong>Modified FOC with Perceived Tax:</strong></p>
    
    <div class="equation">
        $$1 - \tau_{perceived}(y_i^*) - y_i^* \cdot \frac{\partial \tau_{perceived}}{\partial y_i}\bigg|_{y_i^*} = \frac{1}{\alpha} \cdot \frac{1}{A_i^{1/\alpha}} \cdot (y_i^*)^{\frac{1-\alpha}{\alpha}}$$
    </div>
    
    <p>Where:</p>
    
    <div class="equation">
        $$\frac{\partial \tau_{perceived}}{\partial y_i} = \tau_{max} \cdot \phi\left(\frac{y_i - T^*}{\sigma \cdot y_i}\right) \cdot \frac{T^*}{\sigma \cdot y_i^2}$$
    </div>
    
    <p>And $\phi$ is the normal PDF.</p>
    
    <p><strong>Effect of Uncertainty Parameter σ:</strong></p>
    
    <ul>
        <li><strong>σ = 0:</strong> No uncertainty, sharp response at threshold</li>
        <li><strong>σ = 0.05:</strong> 5% uncertainty, moderate smoothing of bunching</li>
        <li><strong>σ = 0.20:</strong> 20% uncertainty, very smooth distribution</li>
    </ul>
    
    <h2>8. General Elasticity Model Calibrated from Bunching Data</h2>
    
    <p><strong>Motivation:</strong> Instead of deriving elasticity from structural parameters, directly calibrate a general elasticity parameter from observed bunching behavior.</p>
    
    <p><strong>Bunching Estimation Framework:</strong></p>
    
    <p>Following Kleven and Waseem (2013), the bunching mass $B$ at threshold $T^*$ identifies the elasticity of taxable income:</p>
    
    <div class="equation">
        $$B = \int_{y^L}^{y^U} h_0(y) dy$$
    </div>
    
    <p>Where:</p>
    <ul>
        <li>$h_0(y)$ is the counterfactual density (no threshold)</li>
        <li>$[y^L, y^U]$ is the bunching region around $T^*$</li>
    </ul>
    
    <p><strong>Elasticity Identification:</strong></p>
    
    <p>The elasticity $\varepsilon$ is identified from the relationship:</p>
    
    <div class="equation">
        $$\varepsilon = \frac{\ln(y^U) - \ln(T^*)}{\ln(1-\tau_1) - \ln(1-\tau_0)}$$
    </div>
    
    <p>Where $\tau_1$ and $\tau_0$ are the tax rates above and below the threshold.</p>
    
    <p>For the VAT threshold with notch structure:</p>
    
    <div class="equation">
        $$\varepsilon = \frac{\Delta y^*/T^*}{\Delta t/(1-t)}$$
    </div>
    
    <p>Where $\Delta y^*$ is the width of the bunching region and $\Delta t$ is the effective tax jump.</p>
    
    <p><strong>General Isoelastic Form:</strong></p>
    
    <p>With constant elasticity $\varepsilon$, firm's optimal output satisfies:</p>
    
    <div class="equation">
        $$y_i^* = \left(\frac{1-\tau(y_i^*)}{MC_i}\right)^{\varepsilon}$$
    </div>
    
    <p>Where $MC_i$ is firm $i$'s marginal cost parameter.</p>
    
    <p><strong>Incorporating into FOC:</strong></p>
    
    <p>The first-order condition with general elasticity becomes:</p>
    
    <div class="equation">
        $$(1-\tau(y_i^*)) \cdot \left(1 - \frac{\varepsilon \cdot y_i^* \cdot \tau'(y_i^*)}{1-\tau(y_i^*)}\right) = MC_i$$
    </div>
    
    <p>Rearranging:</p>
    
    <div class="equation">
        $$(1-\tau(y_i^*)) - \varepsilon \cdot y_i^* \cdot \tau'(y_i^*) = MC_i$$
    </div>
    
    <p><strong>Calibration from Data:</strong></p>
    
    <p>Steps to calibrate $\varepsilon$ from bunching data:</p>
    
    <ol>
        <li><strong>Estimate Counterfactual Distribution:</strong> Fit polynomial to density excluding bunching region</li>
        <li><strong>Calculate Excess Mass:</strong> 
            <div class="equation">
                $$b = \frac{B}{\hat{h}_0(T^*)}$$
            </div>
            where $B$ is total bunching mass and $\hat{h}_0(T^*)$ is counterfactual density at threshold
        </li>
        <li><strong>Find Marginal Buncher:</strong> Identify $y^U$ such that:
            <div class="equation">
                $$\int_{T^*}^{y^U} \hat{h}_0(y) dy = B$$
            </div>
        </li>
        <li><strong>Calculate Elasticity:</strong>
            <div class="equation">
                $$\varepsilon = \frac{(y^U - T^*)/T^*}{\tau_{effective}/(1-\tau_{effective})}$$
            </div>
        </li>
    </ol>
    
    <p><strong>Heterogeneous Elasticities:</strong></p>
    
    <p>Allow elasticity to vary by firm characteristics:</p>
    
    <div class="equation">
        $$\varepsilon_i = \varepsilon_0 + \varepsilon_1 \cdot \ln(A_i) + \varepsilon_2 \cdot \text{Industry}_i$$
    </div>
    
    <p>Where:</p>
    <ul>
        <li>$\varepsilon_0$ is baseline elasticity</li>
        <li>$A_i$ is firm productivity</li>
        <li>$\text{Industry}_i$ captures sector-specific responses</li>
    </ul>
    
    <p><strong>Advantages of General Elasticity Approach:</strong></p>
    
    <ul>
        <li><strong>Model-free:</strong> No need to assume specific production function</li>
        <li><strong>Direct identification:</strong> Elasticity comes directly from observed behavior</li>
        <li><strong>Policy relevant:</strong> Captures actual firm responses including all margins</li>
        <li><strong>Robust:</strong> Works with various underlying firm heterogeneity structures</li>
    </ul>
    
    <p><strong>Implementation with Sigmoid Tax Function:</strong></p>
    
    <p>Combining general elasticity with smooth tax transition:</p>
    
    <div class="equation">
        $$y_i^* \text{ solves: } (1-\tau_{sigmoid}(y_i^*)) - \varepsilon \cdot y_i^* \cdot \tau'_{sigmoid}(y_i^*) = MC_i$$
    </div>
    
    <p>Where:</p>
    
    <div class="equation">
        $$\tau'_{sigmoid}(y) = \frac{k \cdot \tau_{max} \cdot e^{-k(y-T^*)}}{(1 + e^{-k(y-T^*)})^2}$$
    </div>
    
    <p>This can be solved numerically for each firm given their $MC_i$ and the calibrated $\varepsilon$.</p>
    
    <p><strong>Welfare Analysis with Calibrated Elasticity:</strong></p>
    
    <p>The deadweight loss from VAT threshold with elasticity $\varepsilon$ is:</p>
    
    <div class="equation">
        $$DWL = \int_{T^*}^{y^U} \tau(y) \cdot h_0(y) \cdot y \cdot dy + \frac{1}{2} \cdot \varepsilon \cdot \tau^2 \cdot \bar{y} \cdot N$$
    </div>
    
    <p>Where $N$ is the number of affected firms and $\bar{y}$ is average turnover.</p>
    
    <h2>9. Simplified Elasticity Approach for Policy Simulation</h2>
    
    <p><strong>Context:</strong> A shift towards a more standard elasticity model for smoother policies rather than just threshold adjustments, emphasizing the need for a simpler approach that captures firm marginal incentives.</p>
    
    <p><strong>Core Model Framework:</strong></p>
    
    <p>Instead of complex structural models, use a reduced-form approach where firms maximize:</p>
    
    <div class="equation">
        $$\pi_i = (1 - \tau(y_i)) \cdot y_i - c_i(y_i)$$
    </div>
    
    <p>With the key innovation being that $\tau$ can be any smooth function, not just a step function.</p>
    
    <p><strong>Firm Decision Process with Marginal Incentives:</strong></p>
    
    <p>Firms consider marginal changes in turnover. The decision rule becomes:</p>
    
    <div class="equation">
        $$\text{Marginal Revenue} = (1 - \tau) - y \cdot \frac{d\tau}{dy}$$
    </div>
    
    <div class="equation">
        $$\text{Marginal Cost} = \frac{1}{\varepsilon} \cdot \frac{c(y)}{y}$$
    </div>
    
    <p>Where $\varepsilon$ is the single parameter calibrated from bunching.</p>
    
    <p><strong>What is this Elasticity?</strong></p>
    
    <p>The parameter $\varepsilon$ is the <em>elasticity of turnover with respect to the net-of-tax rate</em>:</p>
    
    <div class="equation">
        $$\varepsilon = \frac{d\ln(y)}{d\ln(1-\tau)} = \frac{\partial y}{\partial(1-\tau)} \cdot \frac{1-\tau}{y}$$
    </div>
    
    <p>This measures: <strong>If the net-of-tax rate (1-τ) increases by 1%, by what percentage does firm turnover increase?</strong></p>
    
    <p>For example:</p>
    <ul>
        <li>$\varepsilon = 0.5$ means: A 1% increase in the net-of-tax rate (e.g., from 0.80 to 0.808) leads to a 0.5% increase in turnover</li>
        <li>Higher $\varepsilon$ = firms are more responsive to tax changes</li>
        <li>Lower $\varepsilon$ = firms are less responsive to tax changes</li>
    </ul>
    
    <p><strong>How to Calibrate ε from Bunching:</strong></p>
    
    <p>The elasticity is identified from the excess mass of firms bunching at the VAT threshold:</p>
    
    <ol>
        <li><strong>Measure Bunching Mass:</strong> Count excess firms at threshold relative to smooth counterfactual:
            <div class="equation">
                $$B = \int_{y^*-\Delta}^{y^*} [h_{actual}(y) - h_{counterfactual}(y)] dy$$
            </div>
        </li>
        <li><strong>Identify Marginal Buncher:</strong> The firm indifferent between bunching and not bunching would have produced $y^* + \Delta y^*$ without the threshold
        </li>
        <li><strong>Apply Bunching Formula:</strong> For a VAT notch at threshold $T^*$:
            <div class="equation">
                $$\varepsilon = \frac{\Delta y^* / T^*}{\tau_{VAT} / (1 - \tau_{VAT})}$$
            </div>
            where $\Delta y^*$ is the bunching width and $\tau_{VAT}$ is the effective VAT burden
        </li>
        <li><strong>Example Calculation:</strong> If firms bunch from £85,000-£95,000 (width = £10,000) with 20% VAT:
            <div class="equation">
                $$\varepsilon = \frac{10,000/85,000}{0.20/(1-0.20)} = \frac{0.118}{0.25} = 0.47$$
            </div>
        </li>
    </ol>
    
    <p>This single elasticity captures all behavioral responses without needing structural assumptions.</p>
    
    <p><strong>Smooth Policy Transitions:</strong></p>
    
    <p>Instead of sharp thresholds, model smooth phase-ins:</p>
    
    <div class="equation">
        $$\tau_{smooth}(y) = \begin{cases}
        0 & \text{if } y < T_{lower} \\
        \tau_{max} \cdot \frac{y - T_{lower}}{T_{upper} - T_{lower}} & \text{if } T_{lower} \leq y \leq T_{upper} \\
        \tau_{max} & \text{if } y > T_{upper}
        \end{cases}$$
    </div>
    
    <p>This allows for policy simulations with gradual phase-ins over ranges $[T_{lower}, T_{upper}]$.</p>
    
    <p><strong>Simplified Profit Function for Calibration:</strong></p>
    
    <p>Start with a simple profit function:</p>
    
    <div class="equation">
        $$\pi_i = y_i \cdot (1 - \tau) - y_i^{1/\varepsilon} \cdot \kappa_i$$
    </div>
    
    <p>Where:</p>
    <ul>
        <li>$\kappa_i$ is a firm-specific cost parameter (can be backed out from data)</li>
        <li>$\varepsilon$ is the single elasticity parameter to calibrate</li>
    </ul>
    
    <p><strong>Why the 1/ε Exponent in Costs:</strong></p>
    
    <p>The cost term $y_i^{1/\varepsilon}$ comes from the isoelastic framework:</p>
    
    <ol>
        <li>With constant elasticity $\varepsilon$, firm's optimal output satisfies:
            <div class="equation">
                $$y^* = \left(\frac{1-\tau}{MC}\right)^{\varepsilon}$$
            </div>
        </li>
        <li>Inverting this relationship gives marginal cost:
            <div class="equation">
                $$MC = \frac{1-\tau}{(y^*)^{1/\varepsilon}}$$
            </div>
        </li>
        <li>This implies marginal cost increases as $y^{1/\varepsilon}$, so total cost takes the form:
            <div class="equation">
                $$C(y) \approx y^{1/\varepsilon} \cdot \kappa$$
            </div>
        </li>
        <li>Higher elasticity $\varepsilon$ → flatter cost curve (smaller 1/ε exponent) → more responsive to tax changes</li>
        <li>Lower elasticity $\varepsilon$ → steeper cost curve (larger 1/ε exponent) → less responsive to tax changes</li>
    </ol>
    
    <p>This reduced-form captures the cost structure consistent with observed bunching elasticity without specifying production technology.</p>
    
    <p><strong>Implementation Steps:</strong></p>
    
    <ol>
        <li><strong>Step 1:</strong> Calibrate $\varepsilon$ from bunching using standard methods</li>
        <li><strong>Step 2:</strong> Back out firm-specific $\kappa_i$ from observed turnover:
            <div class="equation">
                $$\kappa_i = \frac{(1 - \tau_{current}(y_i^{obs})) \cdot y_i^{obs}}{(y_i^{obs})^{1/\varepsilon}}$$
            </div>
        </li>
        <li><strong>Step 3:</strong> Simulate new equilibrium under alternative policies:
            <div class="equation">
                $$y_i^{new} = \left[\frac{\varepsilon \cdot (1 - \tau_{new}(y))}{\kappa_i}\right]^{\frac{\varepsilon}{1-\varepsilon}}$$
            </div>
        </li>
        <li><strong>Step 4:</strong> Aggregate to get revenue and welfare effects</li>
    </ol>
    
    <p><strong>Advantages of This Simplified Approach:</strong></p>
    
    <ul>
        <li>Single parameter ($\varepsilon$) to calibrate instead of full structural model</li>
        <li>Can handle any smooth policy function, not just thresholds</li>
        <li>Incorporates firm heterogeneity through $\kappa_i$</li>
        <li>Easily extended with more micro-data as it becomes available</li>
        <li>Computationally simple - no need for complex optimization routines</li>
    </ul>
    
    <p><strong>Policy Simulation Capabilities:</strong></p>
    
    <p>This framework can simulate:</p>
    <ul>
        <li>Changes in threshold levels</li>
        <li>Introduction of phase-in ranges (smooth transitions)</li>
        <li>Sector-specific VAT rates or thresholds</li>
        <li>Multiple threshold systems</li>
        <li>Time-varying policies</li>
    </ul>
    
    <p><strong>Key Insight:</strong> By focusing on elasticity rather than structural parameters, this approach provides flexibility for policy analysis while maintaining the ability to incorporate detailed firm-level responses.</p>
    
    <h2>10. Realistic Behavioral Adjustments for Bunching</h2>
    
    <p><strong>Motivation:</strong> Pure FOC solutions create unrealistic sharp responses at thresholds. Real firms face uncertainty, adjustment costs, and limited optimization ability.</p>
    
    <p><strong>Key Behavioral Realism Factors:</strong></p>
    
    <p><strong>1. Revenue Uncertainty and Safety Margins:</strong></p>
    
    <p>Firms cannot perfectly predict their turnover, leading to precautionary behavior:</p>
    
    <div class="equation">
        $$y_{realized} = y_{planned} \cdot (1 + \epsilon), \quad \epsilon \sim N(0, \sigma^2)$$
    </div>
    
    <p>To avoid accidentally exceeding the threshold, firms target:</p>
    
    <div class="equation">
        $$y_{target} = T^* - \text{buffer} = T^* - z_{\alpha} \cdot \sigma \cdot y_{planned}$$
    </div>
    
    <p>Where $z_{\alpha} \approx 1.645$ for 95% confidence of staying below threshold.</p>
    
    <p><strong>2. Heterogeneous Awareness and Optimization Ability:</strong></p>
    
    <p>Not all firms optimize equally well:</p>
    
    <div class="equation">
        $$\text{Awareness}(y) = \begin{cases}
        0.2 & \text{if } y < £50k \text{ (small firms)} \\
        0.5 & \text{if } £50k \leq y < £80k \text{ (medium firms)} \\
        0.9 & \text{if } £80k \leq y < £120k \text{ (near threshold)} \\
        0.7 & \text{if } y \geq £120k \text{ (large firms)}
        \end{cases}$$
    </div>
    
    <p>Actual response is moderated by awareness:</p>
    
    <div class="equation">
        $$y_{actual} = y_{current} + \text{Awareness} \times \text{OptimizationAbility} \times (y_{optimal}^{FOC} - y_{current})$$
    </div>
    
    <p><strong>3. Bunching Decision Framework:</strong></p>
    
    <p>For firms whose optimal output $y^*$ exceeds the new threshold $T^*$:</p>
    
    <div class="equation">
        $$P(\text{bunch}) = \text{Awareness} \times f(\Delta y)$$
    </div>
    
    <p>Where $f(\Delta y)$ is the bunching probability function:</p>
    
    <div class="equation">
        $$f(\Delta y) = \begin{cases}
        0.8 & \text{if } \Delta y < £15k \text{ (strong incentive)} \\
        0.3 & \text{if } £15k \leq \Delta y < £30k \text{ (moderate incentive)} \\
        0.05 & \text{if } \Delta y \geq £30k \text{ (weak incentive)}
        \end{cases}$$
    </div>
    
    <p>And $\Delta y = y^* - T^*$ is the distance above threshold.</p>
    
    <p><strong>4. Bunching Target Distribution:</strong></p>
    
    <p>Firms that decide to bunch don't all target exactly the threshold:</p>
    
    <div class="equation">
        $$y_{bunch} = T^* - \text{UniformRandom}(£1k, £5k) + \text{Normal}(0, £2k)$$
    </div>
    
    <p>This creates a realistic "bunching cloud" just below the threshold rather than a spike.</p>
    
    <p><strong>5. Adjustment Constraints:</strong></p>
    
    <p>Firms face limits on how much they can adjust:</p>
    
    <div class="equation">
        $$\Delta y_{max} = \min(£25k, 0.4 \times y_{current})$$
    </div>
    
    <p>This prevents unrealistic jumps in firm size.</p>
    
    <p><strong>Implementation Algorithm for Realistic Distribution:</strong></p>
    
    <ol>
        <li><strong>Calculate Pure FOC Solution:</strong> $y^{FOC}$ from standard optimization</li>
        <li><strong>Determine Bunching Decision:</strong>
            <ul>
                <li>If $y^{FOC} > T^*$ and $\Delta y < £30k$: Consider bunching</li>
                <li>Draw random $u \sim U(0,1)$</li>
                <li>If $u < P(\text{bunch})$: Target below threshold</li>
            </ul>
        </li>
        <li><strong>Add Implementation Noise:</strong>
            <ul>
                <li>Small firms: $\sigma = £5k$ (less precise control)</li>
                <li>Large firms: $\sigma = £2k$ (better control)</li>
            </ul>
        </li>
        <li><strong>Apply Adjustment Constraints:</strong> Limit changes to realistic magnitudes</li>
    </ol>
    
    <p><strong>Expected Distribution Pattern:</strong></p>
    
    <p>The realistic distribution shows:</p>
    <ul>
        <li><strong>Below £90k:</strong> Smooth, similar to no-threshold distribution</li>
        <li><strong>£90k-£94k:</strong> Elevated density from bunching firms</li>
        <li><strong>£94k-£95k:</strong> Highest density (bunching peak)</li>
        <li><strong>At £95k:</strong> Sharp drop but not to zero</li>
        <li><strong>£95k-£110k:</strong> "Missing mass" - lower density than optimal</li>
        <li><strong>Above £110k:</strong> Returns to normal density</li>
    </ul>
    
    <p><strong>Welfare Implications of Realistic Behavior:</strong></p>
    
    <p>Realistic adjustments reduce both benefits and costs:</p>
    
    <div class="equation">
        $$\text{DWL}_{realistic} = \alpha \cdot \text{DWL}_{FOC}$$
    </div>
    
    <p>Where $\alpha \approx 0.6$ due to:</p>
    <ul>
        <li>Partial optimization reduces distortion</li>
        <li>Uncertainty creates natural smoothing</li>
        <li>Some firms don't respond at all</li>
    </ul>
    
    <p><strong>Key Insight:</strong> Incorporating realistic behavioral factors transforms the sharp, discontinuous FOC response into a smooth distribution with visible but realistic bunching - matching what we observe in actual firm data.</p>
    
    <h2>11. Simple Uncertainty Model with Precautionary Behavior</h2>
    
    <p><strong>Motivation:</strong> A minimal-assumption model that adds only output uncertainty and rational precautionary behavior to the pure FOC solution.</p>
    
    <p><strong>Core Assumption:</strong></p>
    
    <p>Firms face multiplicative output uncertainty:</p>
    
    <div class="equation">
        $$y_{realized} = y_{planned} \cdot (1 + \epsilon), \quad \epsilon \sim N(0, \sigma^2)$$
    </div>
    
    <p>Where $\sigma$ depends on distance from threshold:</p>
    <ul>
        <li>$\sigma = 0.04$ for firms within £10k of threshold (better control)</li>
        <li>$\sigma = 0.06$ for firms £10-30k from threshold</li>
        <li>$\sigma = 0.08$ for firms far from threshold</li>
    </ul>
    
    <p><strong>Precautionary Behavior Model:</strong></p>
    
    <p>Firms near or above the threshold calculate their probability of exceeding it:</p>
    
    <div class="equation">
        $$P(\text{exceed } T^*) = 1 - \Phi\left(\frac{T^* - y_{optimal}}{\sigma \cdot y_{optimal}}\right)$$
    </div>
    
    <p>Where $\Phi$ is the normal CDF.</p>
    
    <p><strong>Optimal Response Under Uncertainty:</strong></p>
    
    <p>If $P(\text{exceed}) > 0.05$ (more than 5% chance), firms adjust their target:</p>
    
    <div class="equation">
        $$y_{safe} = \frac{T^*}{1 + 1.645 \cdot \sigma}$$
    </div>
    
    <p>This ensures $P(\text{exceed}) \leq 0.05$ (95% confidence of staying below).</p>
    
    <p>The actual planned output blends optimal and safe targets:</p>
    
    <div class="equation">
        $$y_{planned} = (1 - w) \cdot y_{optimal} + w \cdot y_{safe}$$
    </div>
    
    <p>Where weight $w = \min(1, 3 \cdot P(\text{exceed}))$ increases with risk.</p>
    
    <p><strong>Key Differences from Complex Models:</strong></p>
    
    <table style="border-collapse: collapse; width: 100%; margin: 20px 0;">
        <tr style="background-color: #f0f0f0;">
            <th style="padding: 10px; border: 1px solid #ddd;">Aspect</th>
            <th style="padding: 10px; border: 1px solid #ddd;">Complex Bunching Model</th>
            <th style="padding: 10px; border: 1px solid #ddd;">Simple Uncertainty Model</th>
        </tr>
        <tr>
            <td style="padding: 10px; border: 1px solid #ddd;">Firm heterogeneity</td>
            <td style="padding: 10px; border: 1px solid #ddd;">Awareness varies by size</td>
            <td style="padding: 10px; border: 1px solid #ddd;">All firms rational</td>
        </tr>
        <tr>
            <td style="padding: 10px; border: 1px solid #ddd;">Bunching decision</td>
            <td style="padding: 10px; border: 1px solid #ddd;">Probabilistic by distance</td>
            <td style="padding: 10px; border: 1px solid #ddd;">Continuous adjustment</td>
        </tr>
        <tr>
            <td style="padding: 10px; border: 1px solid #ddd;">Parameters</td>
            <td style="padding: 10px; border: 1px solid #ddd;">Many (awareness, ability, etc.)</td>
            <td style="padding: 10px; border: 1px solid #ddd;">One ($\sigma$ uncertainty)</td>
        </tr>
        <tr>
            <td style="padding: 10px; border: 1px solid #ddd;">Mechanism</td>
            <td style="padding: 10px; border: 1px solid #ddd;">Strategic bunching</td>
            <td style="padding: 10px; border: 1px solid #ddd;">Risk management</td>
        </tr>
    </table>
    
    <p><strong>Mathematical Foundation:</strong></p>
    
    <p>The model solves the optimization problem:</p>
    
    <div class="equation">
        $$\max_{y_{planned}} \mathbb{E}[\pi] = \int_{-\infty}^{\infty} \pi(y_{planned}(1+\epsilon)) \cdot \phi(\epsilon/\sigma) d\epsilon$$
    </div>
    
    <p>Subject to the constraint:</p>
    
    <div class="equation">
        $$P(y_{planned}(1 + \epsilon) > T^*) \leq \alpha_{risk}$$
    </div>
    
    <p>Where $\alpha_{risk} = 0.05$ is the firm's risk tolerance.</p>
    
    <p><strong>Expected Distribution Pattern (Orange Curve):</strong></p>
    
    <ul>
        <li><strong>Far below threshold (< £85k):</strong> Nearly identical to FOC solution</li>
        <li><strong>Approaching threshold (£85-93k):</strong> Gradual compression as firms become cautious</li>
        <li><strong>Near threshold (£93-95k):</strong> Smooth accumulation (not sharp spike)</li>
        <li><strong>At threshold (£95k):</strong> Continuous but reduced density</li>
        <li><strong>Just above (£95-100k):</strong> Smooth reduction (not cliff)</li>
        <li><strong>Far above (> £100k):</strong> Converges back to FOC solution</li>
    </ul>
    
    <p><strong>Implementation in Code:</strong></p>
    
    <pre style="background-color: #f5f5f5; padding: 15px; border-radius: 5px;">
<code>def apply_simple_uncertainty(y_optimal, threshold, sigma=0.08):
    # Calculate exceedance probability
    prob_exceed = 1 - norm.cdf(threshold, y_optimal, sigma*y_optimal)
    
    if prob_exceed > 0.05:
        # Apply precautionary adjustment
        safe_target = threshold / (1 + 1.645 * sigma)
        weight = min(1.0, prob_exceed * 3)
        y_planned = (1-weight)*y_optimal + weight*safe_target
    else:
        y_planned = y_optimal
    
    # Add realization noise
    y_realized = y_planned * (1 + np.random.normal(0, sigma))
    return y_realized
</code></pre>
    
    <p><strong>Advantages of Simple Uncertainty Model:</strong></p>
    
    <ul>
        <li><strong>Minimal assumptions:</strong> Only assumes output uncertainty exists</li>
        <li><strong>Single parameter:</strong> Just $\sigma$ (uncertainty level)</li>
        <li><strong>Theoretically grounded:</strong> Based on standard risk management</li>
        <li><strong>Smooth outcomes:</strong> No discontinuous jumps or arbitrary thresholds</li>
        <li><strong>Empirically testable:</strong> $\sigma$ can be estimated from firm revenue volatility data</li>
    </ul>
    
    <p><strong>When to Use Each Model:</strong></p>
    
    <ul>
        <li><strong>Simple Uncertainty Model:</strong> When you want conservative estimates with minimal behavioral assumptions</li>
        <li><strong>Complex Bunching Model:</strong> When you have evidence of strategic behavior and heterogeneous firm responses</li>
        <li><strong>Pure FOC:</strong> As a theoretical benchmark only</li>
    </ul>
    
    <p><strong>Key Insight:</strong> The simple uncertainty model shows that much of the observed bunching pattern can emerge from rational precautionary behavior alone, without assuming complex strategic responses or firm heterogeneity. This provides a lower bound on behavioral responses.</p>
    
    <h2>12. FOC with Output Uncertainty: The Minimal Bunching Model</h2>
    
    <p><strong>Motivation:</strong> The most academically credible approach - start with standard FOC and add only output uncertainty to generate bunching naturally through expected profit maximization.</p>
    
    <p><strong>Core Framework:</strong></p>
    
    <p>Firms face multiplicative output uncertainty:</p>
    
    <div class="equation">
        $$y_{realized} = y_{planned} \cdot (1 + \epsilon), \quad \epsilon \sim N(0, \sigma^2)$$
    </div>
    
    <p>Where $\sigma$ is the only additional parameter beyond standard FOC.</p>
    
    <p><strong>Expected Profit Maximization:</strong></p>
    
    <p>Under uncertainty, firms maximize expected profit:</p>
    
    <div class="equation">
        $$\max_{y_{planned}} \mathbb{E}[\pi] = \mathbb{E}[(1-\tau(y_{realized})) \cdot y_{realized} - c(y_{realized})]$$
    </div>
    
    <p><strong>The Bunching Decision:</strong></p>
    
    <p>For firms whose FOC optimal $y^*$ exceeds the threshold $T^*$, the decision becomes:</p>
    
    <ul>
        <li><strong>Continue above:</strong> Expected profit $= (1-\tau_{VAT}) \cdot y^*$</li>
        <li><strong>Bunch below:</strong> Expected profit $= T^* - \text{safety margin}$</li>
    </ul>
    
    <p><strong>Safety Margin Calculation:</strong></p>
    
    <p>Firms that bunch must ensure they stay below the threshold despite output uncertainty. The safety margin is derived from the probability of exceeding the threshold:</p>
    
    <div class="equation">
        $$P(y_{realized} > T^*) = P(y_{target} \cdot (1 + \epsilon) > T^*) = P(\epsilon > \frac{T^* - y_{target}}{y_{target}})$$
    </div>
    
    <p>To ensure this probability is less than 5% (95% confidence), firms set:</p>
    
    <div class="equation">
        $$y_{target} = \frac{T^*}{1 + 1.645 \cdot \sigma}$$
    </div>
    
    <p>Where 1.645 is the 95th percentile of the standard normal distribution.</p>
    
    <p>This gives a safety margin of:</p>
    
    <div class="equation">
        $$\text{Safety Margin} = T^* - y_{target} = T^* - \frac{T^*}{1 + 1.645 \cdot \sigma} \approx 1.645 \cdot \sigma \cdot T^*$$
    </div>
    
    <p>For example, with $\sigma = 0.04$ (4% uncertainty) and $T^* = £95,000$:</p>
    
    <div class="equation">
        $$\text{Safety Margin} = 1.645 \times 0.04 \times £95,000 = £6,251$$
    </div>
    
    <p>So firms target approximately £88,750 to ensure 95% probability of staying below £95,000.</p>
    
    <p><strong>Breakeven Condition:</strong></p>
    
    <p>Firms bunch if the VAT burden exceeds the output reduction cost:</p>
    
    <div class="equation">
        $$(1-\tau_{VAT}) \cdot y^* < T^*$$
    </div>
    
    <p>This implies bunching occurs when:</p>
    
    <div class="equation">
        $$y^* < \frac{T^*}{1-\tau_{VAT}} = \frac{T^*}{0.8}$$
    </div>
    
    <p>For $T^* = £95,000$ and $\tau_{VAT} = 0.20$, firms bunch if $y^* < £118,750$.</p>
    
    <p><strong>Implementation:</strong></p>
    
    <pre style="background-color: #f5f5f5; padding: 15px; border-radius: 5px;">
<code>def foc_with_uncertainty(y_optimal, threshold=95000, sigma=0.04):
    # Distance from threshold
    distance = y_optimal - threshold
    
    # Only firms above threshold consider bunching
    if distance > 0:
        # Breakeven distance where VAT burden equals benefit
        vat_rate = 0.20
        breakeven = threshold * vat_rate / (1 - vat_rate)
        
        if distance < breakeven:
            # Bunching probability decreases with distance
            bunch_prob = 1 - (distance / breakeven)
            
            if random() < bunch_prob:
                # Calculate safety margin for 95% confidence
                # y_target * (1 + 1.645*sigma) = threshold
                # So: y_target = threshold / (1 + 1.645*sigma)
                safety_margin = 1.645 * sigma * threshold
                y_target = threshold - safety_margin
                
                # Add realization noise
                epsilon = normal(0, sigma)
                return y_target * (1 + epsilon)
    
    # Default: FOC optimal with uncertainty
    epsilon = normal(0, sigma)
    return y_optimal * (1 + epsilon)
</code></pre>
    
    <p><strong>Key Properties:</strong></p>
    
    <ol>
        <li><strong>Minimal assumptions:</strong> Only adds output uncertainty to standard FOC</li>
        <li><strong>Single parameter:</strong> $\sigma$ (typically 2-5% based on firm revenue volatility data)</li>
        <li><strong>Natural bunching:</strong> Emerges from profit maximization, not behavioral assumptions</li>
        <li><strong>Smooth response:</strong> Bunching probability decreases continuously with distance</li>
    </ol>
    
    <p><strong>Expected Distribution Pattern:</strong></p>
    
    <ul>
        <li><strong>Below threshold:</strong> Follows FOC exactly (no behavioral distortion)</li>
        <li><strong>At threshold:</strong> Accumulation from bunching firms</li>
        <li><strong>Just above (£95-100k):</strong> "Hole" - very low density</li>
        <li><strong>Moderate distance (£100-115k):</strong> Mix of bunchers and continuers</li>
        <li><strong>Far above (£115k+):</strong> Returns to FOC</li>
    </ul>
    
    <p><strong>Academic Credibility:</strong></p>
    
    <p>This approach is academically rigorous because:</p>
    
    <ul>
        <li>Builds on standard FOC framework</li>
        <li>Uses expected utility theory</li>
        <li>Uncertainty parameter can be estimated from data</li>
        <li>No ad-hoc behavioral assumptions</li>
        <li>Consistent with Kleven & Waseem (2013) bunching framework</li>
    </ul>
    
    <p><strong>Comparison with Previous Sections:</strong></p>
    
    <table style="border-collapse: collapse; width: 100%; margin: 20px 0;">
        <tr style="background-color: #f0f0f0;">
            <th style="padding: 10px; border: 1px solid #ddd;">Model</th>
            <th style="padding: 10px; border: 1px solid #ddd;">Assumptions</th>
            <th style="padding: 10px; border: 1px solid #ddd;">Parameters</th>
            <th style="padding: 10px; border: 1px solid #ddd;">Credibility</th>
        </tr>
        <tr>
            <td style="padding: 10px; border: 1px solid #ddd;">Section 10: Complex Bunching</td>
            <td style="padding: 10px; border: 1px solid #ddd;">Heterogeneous awareness, optimization ability</td>
            <td style="padding: 10px; border: 1px solid #ddd;">Many</td>
            <td style="padding: 10px; border: 1px solid #ddd;">Medium</td>
        </tr>
        <tr>
            <td style="padding: 10px; border: 1px solid #ddd;">Section 11: Simple Uncertainty</td>
            <td style="padding: 10px; border: 1px solid #ddd;">Precautionary behavior</td>
            <td style="padding: 10px; border: 1px solid #ddd;">Few</td>
            <td style="padding: 10px; border: 1px solid #ddd;">High</td>
        </tr>
        <tr>
            <td style="padding: 10px; border: 1px solid #ddd;">Section 12: FOC + Uncertainty</td>
            <td style="padding: 10px; border: 1px solid #ddd;">Output uncertainty only</td>
            <td style="padding: 10px; border: 1px solid #ddd;">One (σ)</td>
            <td style="padding: 10px; border: 1px solid #ddd;">Highest</td>
        </tr>
    </table>
    
    <p><strong>Key Insight:</strong> This minimal model demonstrates that bunching at VAT thresholds can be explained entirely through standard profit maximization under output uncertainty, without requiring complex behavioral assumptions. The single uncertainty parameter σ can be estimated from firm revenue volatility data, making this approach both parsimonious and empirically grounded.</p>

    <h2>Section 13: Implemented Simplified Bunching Model for Policy Simulation</h2>

    <p><strong>Overview:</strong> This section documents the actual implementation used to generate the "Simplified Bunching" curve (purple) in our policy simulation results. This model represents the most academically credible approach, combining FOC optimization with minimal uncertainty and realistic bunching behavior.</p>

    <h3>13.1 Two-Step Methodology</h3>

    <h4>Step 1: Conservative Unbunching of Historical £85k Data</h4>

    <p>Before simulating the new policy, we must first correct for existing bunching distortions in the observed £85k distribution. However, we apply conservative assumptions recognizing that most firms were likely at their natural positions.</p>

    <p><strong>Economic Breakeven Distance:</strong></p>
    <div class="equation">
        $$d_{max} = T^* \cdot \frac{\tau}{1-\tau} = 85000 \times \frac{0.20}{0.80} = £21,250$$
    </div>

    <p><strong>Identification of Potential Bunching Firms:</strong></p>
    <div class="equation">
        $$\text{Condition: } y_{obs} \leq T^* \text{ and } d = T^* - y_{obs} < d_{max}$$
    </div>

    <p><strong>Conservative Bunching Probability:</strong></p>
    <div class="equation">
        $$P_{bunch}(d) = \alpha \cdot \max\left(0, 1 - \frac{d}{d_{max}}\right)$$
    </div>
    
    <p>where $\alpha = 0.3$ is the conservative factor recognizing that only 30% of theoretically eligible firms were actually bunching.</p>

    <p><strong>True Optimal Estimation (for bunching firms):</strong></p>
    <div class="equation">
        $$\Delta y \sim \text{Exponential}(\lambda = 2000), \text{ clipped to } [500, 8000]$$
    </div>
    
    <div class="equation">
        $$y_{planned} = T^* + \Delta y = 85000 + \Delta y$$
    </div>
    
    <div class="equation">
        $$y_{true} = y_{planned} \times (1 + \varepsilon), \quad \varepsilon \sim N(0, \sigma^2)$$
    </div>

    <p><strong>Default Case (non-bunching firms):</strong></p>
    <div class="equation">
        $$y_{true} = y_{obs} \quad \text{(no adjustment)}$$
    </div>

    <p><strong>Step 2: Policy Simulation with New Threshold</strong></p>

    <p>Using the corrected productivity estimates, simulate firm behavior under £95k threshold:</p>

    <h4>Step 2: Policy Simulation with New £95k Threshold</h4>

    <p>Using corrected productivity estimates $A_i$, we calculate optimal behavior under the new tax regime.</p>

    <h3>13.2 Unified Mathematical Framework</h3>

    <p><strong>Core Uncertainty Model:</strong></p>
    <div class="equation">
        $$y_{realized} = y_{planned} \times (1 + \varepsilon)$$
    </div>
    
    <p>where $\varepsilon \sim N(0, \sigma^2)$ represents output uncertainty.</p>

    <p><strong>Expected Profit Maximization:</strong></p>
    <div class="equation">
        $$\max_{y_{planned}} E[\pi_i] = E[(1 - \tau(y_{realized})) \times y_{realized}] - MC_i \times y_{planned}$$
    </div>

    <p><strong>First-Order Condition:</strong></p>
    <div class="equation">
        $$\frac{\partial E[\pi_i]}{\partial y_{planned}} = 0$$
    </div>

    <h4>13.2.1 Policy Simulation Bunching Logic</h4>

    <p><strong>Distance from New Threshold:</strong></p>
    <div class="equation">
        $$d_{new} = y_{FOC}^* - T_{new}^*, \quad \text{where } T_{new}^* = £95,000$$
    </div>

    <p><strong>Bunching Range Condition:</strong></p>
    <div class="equation">
        $$\text{Eligible for bunching: } d_{new} > 0 \text{ and } d_{new} < d_{range} = £15,000$$
    </div>

    <p><strong>Enhanced Bunching Probability:</strong></p>
    <div class="equation">
        $$P_{bunch}(d_{new}) = \min\left(0.95, \beta \cdot \max\left(0, 1 - \frac{d_{new}}{d_{max}}\right)\right)$$
    </div>
    
    <p>where $\beta = 1.2$ is the bunching intensity multiplier and $d_{max} = £23,750$.</p>

    <p><strong>Bunching Target Distribution:</strong></p>
    <div class="equation">
        $$\Delta y_{bunch} \sim \text{Exponential}(\lambda = 2500), \text{ clipped to } [1000, 8000]$$
    </div>

    <p><strong>Target Turnover (for bunching firms):</strong></p>
    <div class="equation">
        $$y_{target} = T_{new}^* - \Delta y_{bunch} = 95000 - \Delta y_{bunch}$$
    </div>

    <p><strong>Final Realized Turnover:</strong></p>
    <div class="equation">
        $$y_{final} = \begin{cases}
        y_{target} \times (1 + 0.3\varepsilon) & \text{if bunching} \\
        y_{FOC}^* \times (1 + 0.7\varepsilon) & \text{if not bunching}
        \end{cases}$$
    </div>
    
    <p>where the reduced noise factors (0.3, 0.7) create smoother distributions.</p>

    <p><strong>Exponential Distribution for Bunching Distance:</strong></p>

    <div class="math-block">
        <strong>Distance from threshold when bunching:</strong>
        <br>Δy ~ Exponential(λ = 3000), clipped to appropriate range
        <br><br>
        <strong>PDF:</strong> f(Δy) = (1/λ)e<sup>-Δy/λ</sup> for Δy ≥ 0
        <br><br>
        <strong>Economic Interpretation:</strong>
        <br>• Most firms bunch close to threshold (mode at 0)
        <br>• Some firms bunch further away (exponential tail)
        <br>• Parameter λ controls the spread of bunching
    </div>

    <p><strong>Bunching Decision Rule:</strong></p>

    <div class="math-block">
        For firms with FOC optimum y* > T<sub>new</sub> = £95,000:
        <br><br>
        <strong>Distance from threshold:</strong> d = y* - 95000
        <br><br>
        <strong>Breakeven distance:</strong> d<sub>max</sub> = T<sub>new</sub> × τ/(1-τ) ≈ £23,750
        <br><br>
        <strong>Bunching probability:</strong>
        <br>P<sub>bunch</sub> = max(0, 1 - d/d<sub>max</sub>) if d < d<sub>max</sub>
        <br><br>
        <strong>If bunching, target location:</strong>
        <br>y<sub>target</sub> = 95000 - Exp(λ = 3000), clipped to [£500, £7000] below threshold
    </div>

    <h3>13.3 Key Parameters and Their Effects</h3>

    <table style="border-collapse: collapse; width: 100%; margin: 20px 0;">
        <tr style="background-color: #f0f0f0;">
            <th style="padding: 10px; border: 1px solid #ddd;">Parameter</th>
            <th style="padding: 10px; border: 1px solid #ddd;">Current Value</th>
            <th style="padding: 10px; border: 1px solid #ddd;">Effect of Increase</th>
            <th style="padding: 10px; border: 1px solid #ddd;">Effect of Decrease</th>
        </tr>
        <tr>
            <td style="padding: 10px; border: 1px solid #ddd;"><strong>σ</strong> (output uncertainty)</td>
            <td style="padding: 10px; border: 1px solid #ddd;">0.04</td>
            <td style="padding: 10px; border: 1px solid #ddd;">More dispersed distributions, less precise bunching</td>
            <td style="padding: 10px; border: 1px solid #ddd;">Sharper bunching, less realistic noise</td>
        </tr>
        <tr>
            <td style="padding: 10px; border: 1px solid #ddd;"><strong>λ</strong> (bunching spread)</td>
            <td style="padding: 10px; border: 1px solid #ddd;">3000</td>
            <td style="padding: 10px; border: 1px solid #ddd;">Bunching spread further below threshold</td>
            <td style="padding: 10px; border: 1px solid #ddd;">More concentrated bunching near threshold</td>
        </tr>
        <tr>
            <td style="padding: 10px; border: 1px solid #ddd;"><strong>d<sub>max</sub></strong> (bunching range)</td>
            <td style="padding: 10px; border: 1px solid #ddd;">20000</td>
            <td style="padding: 10px; border: 1px solid #ddd;">More firms consider bunching</td>
            <td style="padding: 10px; border: 1px solid #ddd;">Only very close firms bunch</td>
        </tr>
        <tr>
            <td style="padding: 10px; border: 1px solid #ddd;"><strong>Unbunching window</strong></td>
            <td style="padding: 10px; border: 1px solid #ddd;">d<sub>max</sub> = £21,250</td>
            <td style="padding: 10px; border: 1px solid #ddd;">Captures all economically relevant bunching firms</td>
            <td style="padding: 10px; border: 1px solid #ddd;">N/A (economically determined parameter)</td>
        </tr>
        <tr>
            <td style="padding: 10px; border: 1px solid #ddd;"><strong>k</strong> (sigmoid steepness)</td>
            <td style="padding: 10px; border: 1px solid #ddd;">0.01</td>
            <td style="padding: 10px; border: 1px solid #ddd;">Sharper tax function transition</td>
            <td style="padding: 10px; border: 1px solid #ddd;">Smoother tax function, less bunching incentive</td>
        </tr>
        <tr>
            <td style="padding: 10px; border: 1px solid #ddd;"><strong>α₀</strong> (base bunching intensity)</td>
            <td style="padding: 10px; border: 1px solid #ddd;">Calibrated from data (0 ≤ α₀ ≤ 1)</td>
            <td style="padding: 10px; border: 1px solid #ddd;">More firms bunch at optimal distances</td>
            <td style="padding: 10px; border: 1px solid #ddd;">Fewer firms bunch, more follow pure FOC</td>
        </tr>
        <tr>
            <td style="padding: 10px; border: 1px solid #ddd;"><strong>β</strong> (distance decay)</td>
            <td style="padding: 10px; border: 1px solid #ddd;">Estimated from observed pattern</td>
            <td style="padding: 10px; border: 1px solid #ddd;">Bunching decreases faster with distance</td>
            <td style="padding: 10px; border: 1px solid #ddd;">More uniform bunching across distances</td>
        </tr>
        <tr>
            <td style="padding: 10px; border: 1px solid #ddd;"><strong>Functional form</strong></td>
            <td style="padding: 10px; border: 1px solid #ddd;">Constant/Linear/Exponential/Logistic</td>
            <td style="padding: 10px; border: 1px solid #ddd;">Better fit to data, more parameters</td>
            <td style="padding: 10px; border: 1px solid #ddd;">Simpler form, fewer parameters</td>
        </tr>
    </table>


    <h3>13.3 Mathematical Summary</h3>

    <p><strong>Unified Framework:</strong> This implementation demonstrates that academically credible bunching behavior can be modeled using a single, unified mathematical framework applied consistently to both historical correction and policy simulation.</p>

    <p><strong>Conservative Empirical Calibration:</strong></p>
    <div class="equation">
        $$P_{bunch}(d_{new}) = \min \left( 0.95, \beta \cdot \max \left( 0, 1 - \frac{d_{new}}{d_{max}} \right) \right)$$
    </div>
    
    <p>where:</p>
    <ul>
        <li>$\beta$: Bunching intensity parameter (calibrated from data)</li>
        <li>$d_{max} = T^* \times \frac{\tau}{1-\tau}$: Economic breakeven distance</li>
        <li>$d_{new} = y^* - T^*_{new}$: Distance above new threshold for policy simulation</li>
        <li>Cap at 95% to maintain realistic bounds</li>
    </ul>

    <p><strong>Universal Uncertainty Formula:</strong></p>
    <div class="equation">
        $$y_{realized} = y_{planned} \times (1 + \varepsilon), \quad \varepsilon \sim N(0, \sigma^2)$$
    </div>

    <p><strong>Universal Distance Distribution:</strong></p>
    <div class="equation">
        $$\Delta y \sim \text{Exponential}(\lambda), \text{ with appropriate clipping}$$
    </div>
    
    <p>where $\lambda$ varies by application: $\lambda = 2000$ for unbunching, $\lambda = 2500$ for policy simulation.</p>

    <h2>14. FOC + Uncertainty Only Model (Orange Curve)</h2>
    
    <p>To isolate the effect of optimization uncertainty from bunching behavior, we implement a baseline model that applies only the uncertainty term to the FOC optimal solutions:</p>
    
    <h3>14.1 Mathematical Formulation</h3>
    
    <p><strong>Threshold-Aware Uncertainty Model:</strong></p>
    <div class="equation">
        $$y_{uncertainty} = y_{FOC}^* \times (1 + \varepsilon_i)$$
    </div>
    
    <p>where the uncertainty term $\varepsilon_i$ is threshold-aware:</p>
    
    <div class="equation">
        $$\varepsilon_i = \begin{cases}
        N(\mu_{skew}, \sigma^2) & \text{if } 0 < y_{FOC}^* - T^* < 10000 \\
        N(0, \sigma^2) & \text{otherwise}
        \end{cases}$$
    </div>
    
    <p>with asymmetric mean for firms close above threshold:</p>
    <div class="equation">
        $$\mu_{skew} = -1.5\sigma \left(1 - \frac{y_{FOC}^* - T^*}{10000}\right)$$
    </div>
    
    <p><strong>Economic Rationale:</strong> Firms close above thresholds face asymmetric risk - negative revenue shocks keep them below threshold (avoiding VAT), while positive shocks trigger VAT on all turnover. This creates natural precautionary behavior through uncertainty alone.</p>
    
    <h3>14.2 Purpose and Interpretation</h3>
    
    <p>This model serves as a <strong>baseline counterfactual</strong> that shows:</p>
    <ul>
        <li>Which firms change turnover due to <em>uncertainty alone</em></li>
        <li>Natural smoothing of the FOC distribution without behavioral assumptions</li>
        <li>Clean separation between optimization noise and strategic bunching</li>
        <li>Realistic firm heterogeneity through stochastic variation</li>
    </ul>
    
    <h3>14.3 Implementation</h3>
    
    <div class="equation">
        $$\text{For each firm } i: \quad y_i^{uncertainty} = \text{solve_FOC}(A_i, T_{new}^*) \times (1 + \varepsilon_i)$$
    </div>
    
    <p>where $\varepsilon_i$ is firm-specific uncertainty drawn from $N(0, 0.04^2)$ with deterministic seed based on firm characteristics to ensure reproducibility.</p>
    
    <h3>14.4 Key Advantage</h3>
    
    <p>This approach <strong>minimizes assumptions</strong> by including only:</p>
    <ol>
        <li>Standard FOC optimization</li>
        <li>Single uncertainty parameter (empirically estimable)</li>
        <li>No behavioral bunching assumptions</li>
        <li>No complex adjustment factors</li>
    </ol>
    
    <p>The orange curve demonstrates that realistic firm distributions can be generated with minimal assumptions, providing a credible baseline for policy analysis.</p>
    
</body>
</html>